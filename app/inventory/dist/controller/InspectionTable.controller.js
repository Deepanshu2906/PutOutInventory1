sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/Fragment","sap/ui/model/json/JSONModel"],function(e,t,a,n){"use strict";let i=0;return e.extend("inventory.controller.InspectionTable",{onInit:function(){const e=this.getOwnerComponent().getRouter();e.getRoute("RouteInspectionTable").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:async function(){try{this.resetTableControls();const e=JSON.parse(sessionStorage.getItem("materialData"));let t=this.getOwnerComponent().getModel();let n=t.bindList("/rqMaterial",undefined,undefined,undefined,undefined);let i=await n.requestContexts(0,Infinity);let l=i.map(e=>e.getObject());let o=l.filter(t=>t.reqNo===e);let s=new a(o);this.getView().setModel(s,"materialData");let r=this.byId("materialTable");r.attachEventOnce("updateFinished",this.resetTableControls.bind(this))}catch(e){console.error("Error loading material data:",e)}},resetTableControls:function(){let e=this.byId("materialTable");e.getItems().forEach(function(e){let t=e.getCells();let a=t[4];if(a instanceof sap.m.Input){a.data("originalValue",a.getValue())}})},onMaterialRowSelect:async function(e){const a=this.getView();let n=e.getSource().getParent().getBindingContext("materialData");let i=n.getObject();let l=i.MaterialCode;const o=JSON.parse(sessionStorage.getItem("materialData"));let s=this.getOwnerComponent().getModel();let r=s.bindList("/rqSubMaterial",undefined,undefined,undefined,undefined);let d=await r.requestContexts(0,Infinity);let c=d.map(e=>e.getObject());let u=c.filter(e=>e.reqNo===o&&e.Parent_MaterialCode===l);console.log("Bid details data:",u);let g=u||[];if(!this.expandCheckinDataFragment){t.load({id:a.getId(),name:"inventory.fragments.subComponent",controller:this}).then(e=>{this.expandCheckinDataFragment=e;a.addDependent(this.expandCheckinDataFragment);let t=new sap.ui.model.json.JSONModel(g);this.expandCheckinDataFragment.setModel(t,"subMaterialData");this.expandCheckinDataFragment.open()}).catch(e=>{console.error("Failed to load fragment:",e)})}else{let e=new sap.ui.model.json.JSONModel(g);this.expandCheckinDataFragment.setModel(e,"subMaterialData");this.expandCheckinDataFragment.open()}},_onStatusTypeChange:function(e){var t=e.getSource();var a=t.getSelectedItem().getText();console.log("selected item",a)},_onObjectMatched:async function(){try{this.resetTableControls();const e=JSON.parse(sessionStorage.getItem("materialData"));console.log("Request Number:",e);let t=this.getOwnerComponent().getModel();let n=t.bindList("/rqMaterial",undefined,undefined,undefined,undefined);let i=await n.requestContexts(0,Infinity);let l=i.map(e=>e.getObject());let o=l.filter(t=>t.reqNo===e);console.log("Filtered Data:",o);let s=new a(o);this.getView().setModel(s,"materialData");let r=this.byId("materialTable");r.attachEventOnce("updateFinished",this.resetTableControls.bind(this))}catch(e){console.error("Error loading material data:",e);sap.m.MessageToast.show("Error loading material data: "+e.message)}},_onCancelCheckinSubFragment:function(){this.expandCheckinDataFragment.close()},onSubmit:function(){let e=this.byId("materialTable");let t=e.getBinding("items").getCurrentContexts();t.forEach(e=>{let t=e.getObject();let a={reqNo:t.reqNo,MaterialCode:t.MaterialCode,Status:t.Status,Quantity:t.Quantity,Remarks:t.Remarks};console.log("payload",a);let n=this.getOwnerComponent().getModel();let i=n.bindList("/splitMaterilalTable");i.create(a);sap.m.MessageToast.show("Successfully Submited")})},onsavesubcomponent:function(){let e=this.byId("expandSubTable");let t=e.getBinding("items").getCurrentContexts();t.forEach(e=>{let t=e.getObject();let a={reqNo:t.reqNo,MaterialCode:t.MaterialCode,Parent_MaterialCode:t.Parent_MaterialCode,Status:t.Status,Quantity:t.Quantity,Remarks:t.Remarks};console.log("payload",a);let n=this.getOwnerComponent().getModel();let i=n.bindList("/splitSubMaterialTable");i.create(a);sap.m.MessageToast.show("Successfully Submited")})},quantityChange:function(e){let t=e.getSource();let a=parseFloat(t.getValue());let n=parseFloat(t.data("originalValue"));if(!isNaN(n)&&!isNaN(a)){let e=n-a;console.log("Original Quantity:",n);console.log("New Quantity:",a);console.log("Difference in Quantity:",e);if(e<0){sap.m.MessageToast.show("Original quantity exceeded. No row added.");console.warn("Original quantity exceeded. New quantity cannot be less than the original.")}else{let a=t.getBindingContext("materialData");let n=a.getObject();let i=Object.assign({},n);i.Quantity=e;let l=this.getView().getModel("materialData");let o=l.getData();o.push(i);l.setData(o);sap.m.MessageToast.show("Row duplicated successfully with Quantity difference.")}}else{console.log("Invalid quantity values")}},quantityChangeSub:function(e){let t=e.getSource();let a=parseFloat(t.getValue());let n=parseFloat(t.data("SubQuantityInput2"));if(!isNaN(n)&&!isNaN(a)){let e=n-a;console.log("Original Quantity:",n);console.log("New Quantity:",a);console.log("Difference in Quantity:",e)}else{console.log("Invalid quantity values");sap.m.MessageToast.show("Invalid quantity entered.")}}})});
//# sourceMappingURL=InspectionTable.controller.js.map